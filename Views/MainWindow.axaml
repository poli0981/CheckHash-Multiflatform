<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CheckHash.ViewModels"
        xmlns:icons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        x:Class="CheckHash.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="HashChecker Pro"
        Width="900" Height="600"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource AppBackgroundBrush}"
        SystemDecorations="Full"
        CanResize="True">

<Window.DataTemplates>
    
    <DataTemplate DataType="vm:CreateHashViewModel">
        <Grid RowDefinitions="Auto, Auto, *">
            <Grid ColumnDefinitions="*, Auto">
                <TextBlock Text="Tạo Hash &amp; Nén" FontSize="24" FontWeight="Bold" Margin="0,0,0,15"/>
                <TextBlock Grid.Column="1" Text="{Binding TotalFilesText}" VerticalAlignment="Center" Opacity="0.7"/>
            </Grid>

            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" Margin="0,0,0,15">
                <Button Content="Thêm Files..." Command="{Binding AddFilesCommand}" 
                        CommandParameter="{Binding $parent[Window]}" Classes="accent"/>
                <Button Content="Xóa DS" Command="{Binding ClearListCommand}"/>
                <Button Content="Nén (.Zip)" 
                        Command="{Binding CompressFilesCommand}"
                        CommandParameter="{Binding $parent[Window]}"
                        IsEnabled="{Binding Files.Count}"/>
                <Button Content="TÍNH TẤT CẢ" 
                        Background="{DynamicResource SystemAccentColor}" Foreground="White"
                        Command="{Binding ComputeAllCommand}"/>
            </StackPanel>

            <ListBox Grid.Row="2" ItemsSource="{Binding Files}" Background="Transparent">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#30808080" BorderThickness="0,0,0,1" Padding="5">
                            <Grid ColumnDefinitions="*, 90, 150, 40, 90, 100"> 
                                
                                <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0">
                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding FileName}"/>
                                    <TextBlock Text="{Binding FilePath}" FontSize="10" Opacity="0.6" TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                                
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding $parent[ListBox].((vm:CreateHashViewModel)DataContext).AlgorithmList}"
                                          SelectedItem="{Binding SelectedAlgorithm}"
                                          VerticalAlignment="Center" Margin="0,0,5,0"/>

                                <TextBox Grid.Column="2" Text="{Binding ResultHash}" 
                                         IsReadOnly="True" VerticalAlignment="Center" 
                                         FontSize="11" FontFamily="Consolas, Monospace"
                                         BorderThickness="0" Background="Transparent"/>

                                <Button Grid.Column="3" Padding="5" Background="Transparent" BorderThickness="0"
                                        Command="{Binding $parent[ListBox].((vm:CreateHashViewModel)DataContext).CopyToClipboardCommand}"
                                        CommandParameter="{Binding ResultHash}"
                                        IsVisible="{Binding ResultHash, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        ToolTip.Tip="Copy Hash">
                                    <icons:MaterialIcon Kind="ContentCopy" Width="16" Height="16"/>
                                </Button>

                                <TextBlock Grid.Column="4" Text="{Binding Status}" 
                                           VerticalAlignment="Center" Foreground="#00bfff" FontSize="10" TextWrapping="Wrap"/>

                                <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="5" HorizontalAlignment="Right">
                                    
                                    <Button Padding="5" ToolTip.Tip="Lưu file hash" Background="Transparent"
                                            Command="{Binding $parent[ListBox].((vm:CreateHashViewModel)DataContext).SaveHashFileCommand}"
                                            CommandParameter="{Binding .}"
                                            IsEnabled="{Binding ResultHash, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                         <icons:MaterialIcon Kind="ContentSave" Width="18" Height="18"/>
                                    </Button>

                                    <Button Padding="5" ToolTip.Tip="Tính mã file này" Background="Transparent"
                                            Command="{Binding $parent[ListBox].((vm:CreateHashViewModel)DataContext).ComputeSingleCommand}"
                                            CommandParameter="{Binding .}">
                                        <icons:MaterialIcon Kind="PlayCircleOutline" Width="18" Height="18" Foreground="LimeGreen"/>
                                    </Button>

                                    <Button Padding="5" ToolTip.Tip="Xóa khỏi list" Background="Transparent"
                                            Command="{Binding $parent[ListBox].((vm:CreateHashViewModel)DataContext).RemoveFileCommand}"
                                            CommandParameter="{Binding .}">
                                        <icons:MaterialIcon Kind="TrashCanOutline" Width="18" Height="18" Foreground="#FF6060"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="vm:CheckHashViewModel">
        <Grid RowDefinitions="Auto, Auto, Auto, *">
            <Grid ColumnDefinitions="*, Auto">
                <TextBlock Text="Kiểm tra hàng loạt" FontSize="24" FontWeight="Bold" Margin="0,0,0,15"/>
                <TextBlock Grid.Column="1" Text="{Binding TotalFilesText}" VerticalAlignment="Center" Opacity="0.7"/>
            </Grid>

            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
                <Button Content="Thêm Files..." Classes="accent" 
                        Command="{Binding AddFilesToCheckCommand}" 
                        CommandParameter="{Binding $parent[Window]}"/>
                <Button Content="Xóa DS" Command="{Binding ClearListCommand}"/>
                
                <TextBlock Text="Mẫu:" VerticalAlignment="Center"/>
                <ComboBox ItemsSource="{Binding AlgorithmList}" SelectedItem="{Binding GlobalAlgorithm}" Width="150"/>

                <Button Content="CHECK ALL" 
                        Background="{DynamicResource SystemAccentColor}" Foreground="White"
                        Command="{Binding VerifyAllCommand}"/>
            </StackPanel>

            <ProgressBar Grid.Row="2" Minimum="0" Maximum="{Binding ProgressMax}" Value="{Binding ProgressValue}" 
                         IsVisible="{Binding IsChecking}" Height="4" Margin="0,0,0,10"/>

            <ListBox Grid.Row="3" ItemsSource="{Binding Files}" Background="Transparent">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#30808080" BorderThickness="0,0,0,1" Padding="5">
                            <Grid ColumnDefinitions="*, 200, 100, 80">
                                
                                <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0">
                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding FilePath}" FontSize="10" Opacity="0.6" TextTrimming="CharacterEllipsis"/>
                                </StackPanel>

                                <TextBox Grid.Column="1" Text="{Binding ExpectedHash}" 
                                         Watermark="Paste mã hash..."
                                         AcceptsReturn="False" MaxLines="1"
                                         Margin="0,0,10,0" VerticalAlignment="Center"
                                         FontFamily="Consolas, Monospace" FontSize="11"/>

                                <TextBlock Grid.Column="2" Text="{Binding Status}" 
                                           FontWeight="Bold" VerticalAlignment="Center" TextWrapping="Wrap" FontSize="11">
                                    <TextBlock.Styles>
                                        <Style Selector="TextBlock">
                                            <Setter Property="Foreground" Value="Gray"/>
                                        </Style>
                                        <Style Selector="TextBlock[Text='HỢP']">
                                            <Setter Property="Foreground" Value="LimeGreen"/>
                                        </Style>
                                        <Style Selector="TextBlock[Text='SAI']">
                                            <Setter Property="Foreground" Value="#FF4500"/>
                                        </Style>
                                        <Style Selector="TextBlock[Text='Thiếu']">
                                            <Setter Property="Foreground" Value="#DAA520"/>
                                        </Style>
                                    </TextBlock.Styles>
                                </TextBlock>

                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="5" HorizontalAlignment="Right">
                                    <Button Padding="5" ToolTip.Tip="Check file này" Background="Transparent"
                                            Command="{Binding $parent[ListBox].((vm:CheckHashViewModel)DataContext).VerifySingleCommand}"
                                            CommandParameter="{Binding .}">
                                        <icons:MaterialIcon Kind="PlayCircleOutline" Width="18" Height="18" Foreground="LimeGreen"/>
                                    </Button>

                                    <Button Padding="5" ToolTip.Tip="Xóa khỏi list" Background="Transparent"
                                            Command="{Binding $parent[ListBox].((vm:CheckHashViewModel)DataContext).RemoveFileCommand}"
                                            CommandParameter="{Binding .}">
                                        <icons:MaterialIcon Kind="TrashCanOutline" Width="18" Height="18" Foreground="#FF6060"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </DataTemplate>

</Window.DataTemplates>

    <SplitView IsPaneOpen="{Binding IsPaneOpen}"
               DisplayMode="CompactInline"
               OpenPaneLength="220"
               CompactPaneLength="60"
               PaneBackground="{DynamicResource PaneBackgroundBrush}">
        
        <SplitView.Pane>
            <Grid RowDefinitions="Auto, *, Auto"> 
                <Button Grid.Row="0" Command="{Binding TriggerPaneCommand}" 
                        Width="60" Height="60" Background="Transparent">
                    <icons:MaterialIcon Kind="Menu" Width="28" Height="28"/>
                </Button>
                
                <StackPanel Grid.Row="1" Spacing="0">
                     <StackPanel.Styles>
                        <Style Selector="Button.MenuBtn">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Height" Value="50"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="HorizontalAlignment" Value="Stretch"/>
                        </Style>
                    </StackPanel.Styles>

                    <Button Command="{Binding NavigateToCreateCommand}" Classes="MenuBtn">
                        <Grid ColumnDefinitions="60, *">
                            <icons:MaterialIcon Grid.Column="0" Kind="FilePlus" Width="24" Height="24" HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="Tạo Hash" VerticalAlignment="Center" IsVisible="{Binding IsPaneOpen}" FontWeight="SemiBold"/>
                        </Grid>
                    </Button>

                    <Button Command="{Binding NavigateToCheckCommand}" Classes="MenuBtn">
                        <Grid ColumnDefinitions="60, *">
                            <icons:MaterialIcon Grid.Column="0" Kind="FileCheck" Width="24" Height="24" HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="Kiểm tra Hash" VerticalAlignment="Center" IsVisible="{Binding IsPaneOpen}" FontWeight="SemiBold"/>
                        </Grid>
                    </Button>
                </StackPanel>

                <Button Grid.Row="2" Command="{Binding ToggleThemeCommand}" 
                        Height="50" Background="Transparent" BorderThickness="0" Padding="0" HorizontalAlignment="Stretch">
                    <Grid ColumnDefinitions="60, *">
                        <icons:MaterialIcon Grid.Column="0" Kind="ThemeLightDark" Width="24" Height="24" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="1" Text="Đổi giao diện" VerticalAlignment="Center" IsVisible="{Binding IsPaneOpen}"/>
                    </Grid>
                </Button>
            </Grid>
        </SplitView.Pane>

        <SplitView.Content>
            <Border Padding="20">
                <ContentControl Content="{Binding CurrentPage}" />
            </Border>
        </SplitView.Content>
    </SplitView>
</Window>